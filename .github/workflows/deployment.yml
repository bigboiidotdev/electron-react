name: Build and Send to Discord

on:
  release:

jobs:
  build:
    runs-on: windows-2019

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Get Latest Release Tag
        id: get-latest-tag
        run: echo "{latest_tag}::{git describe --abbrev=0 --tags}" >> $GITHUB_OUTPUT

      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm install

      - name: Build (Win)
        run: npm run package -- --win

      - name: Get Release .exe
        id: get-exe
        run: echo "{exe_path}={find ./release/build -name 'ElectronReact Setup*.exe' -type f | head -n 1}" >> $GITHUB_OUTPUT

      - name: Get Release Description
        id: get-release-description
        run: |
          echo "{description}::{git show -s --format=%b ${GITHUB_REF}}"

      - name: Print
        run: |
          echo "file: ${{ steps.get-exe.outputs.exe_path }}"
          echo "Release Tag: ${{ steps.get-latest-tag.outputs.latest_tag }}"
          echo "Release Description: ${{ steps.get-release-description.outputs.description }}"

      # - name: Send to Discord
      #   uses: appleboy/discord-action@master
      #   env:
      #     DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
      #   with:
      #     message: |
      #       New release available! Download the latest .exe file:
      #       Release Description: ${{ steps.get-release-description.outputs.release_description }}
      #     file_paths: ${{ steps.get-exe.outputs.exe_path }}
