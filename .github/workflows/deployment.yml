name: Build and Send to Discord

on:
  release:

jobs:
  build:
    runs-on: windows-2019

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Get Latest Release Tag
        id: get-latest-tag
        run: echo "::set-env name=TAG_TITLE::$(git describe --abbrev=0 --tags)"

      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm install

      - name: Build (Win)
        run: npm run package -- --win

      - name: Get Release .exe
        id: get-exe
        run: echo "::set-env name=EXE_PATH::$(find . -type f -name '*.exe' | grep 'ElectronReact Setup.*\.exe')"

      - name: Get Release Description
        id: get-release-description
        run: echo "::set-env name=DESCRIPTION::$(git show -s --format=%b ${GITHUB_REF})"

      - name: Print
        run: |
          echo "file: ${{ env.EXE_PATH }}"
          echo "Release Tag: ${{ env.TAG_TITLE }}"
          echo "Release Description: ${{ env.DESCRIPTION }}"

      # - name: Send to Discord
      #   uses: appleboy/discord-action@master
      #   env:
      #     DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
      #   with:
      #     message: |
      #       New release available! Download the latest .exe file:
      #       Release Description: ${{ steps.get-release-description.outputs.release_description }}
      #     file_paths: ${{ steps.get-exe.outputs.exe_path }}
