name: Build and Send to Discord

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      # - name: Get Latest Release Tag
      #   id: get-latest-tag
      #   run: echo "TAG_TITLE=$(git describe --abbrev=0 --tags)" >> $GITHUB_OUTPUT

      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm install

      - name: Build (Win)
        run: npm run package -- --win

      - name: Get Release .exe
        id: get-exe
        run: |
          mkdir ${{ github.workspace }}\.github_output
          dir ${{ github.workspace }}\release\build /b *.exe > output.txt
          set /p FILE_PATH=<output.txt
          copy /Y "%FILE_PATH%" ${{ github.workspace }}\.github_output\
          echo "::set-output name=EXE_PATH::${{ github.workspace }}\.github_output"

      # - name: Get Release Description
      #   id: get-release-description
      #   run: echo "DESCRIPTION=$(git show -s --format="%b" $env:GITHUB_REF)" >> $GITHUB_OUTPUT

      - name: Print
        run: |
          echo "file: ${{ steps.get-exe.outputs.EXE_PATH }}"

      # - name: Send to Discord
      #   uses: appleboy/discord-action@master
      #   env:
      #     DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
      #   with:
      #     message: |
      #       New release available! Download the latest .exe file:
      #       Release Description: ${{ steps.get-release-description.outputs.release_description }}
      #     file_paths: ${{ steps.get-exe.outputs.exe_path }}
